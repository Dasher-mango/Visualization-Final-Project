<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pie Chart with Floating Tooltip</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        /* Styling for the tooltip */
        .tooltip {
		  position: absolute;
		  padding: 7px;
		  font-size: 0.9em;
		  pointer-events: none;
		  background: #fff;
		  border: 1px solid #ccc;
		  border-radius: 4px;

		  /* 添加阴影效果 */
		  -moz-box-shadow:    3px 3px 10px 0px rgba(0, 0, 0, 0.25);
		  -webkit-box-shadow: 3px 3px 10px 0px rgba(0, 0, 0, 0.25);
		  box-shadow:         3px 3px 10px 0px rgba(0, 0, 0, 0.25);
		}

        /* Styling for the chart container */
        #pie-chart-container {
            width: 430px;
            height: 300px;
            position: relative;
        }
    </style>
</head>
<body>
    <!-- Your chart container -->
    <div id="pie-chart-container">
        <!-- Your pie chart will be appended here -->
    </div>

    <script>
        // Sample data with age and gender attributes
        var data = [
        { name: "Person 1", age: 25, gender: "male" },
        { name: "Person 2", age: 35, gender: "female" },
        { name: "Person 3", age: 45, gender: "male" },
        { name: "Person 3", age: 45, gender: "female" },
        // ... more data
        ];

        // Define age groups and thresholds
        var ageGroups = [0, 18, 25, 35, 45, 60, 100];

        // Create a scale for mapping age to age groups
        var ageScale = d3.scaleThreshold()
        .domain(ageGroups)
        .range(d3.range(ageGroups.length - 1));

        // Map data to age groups
        data.forEach(function (d) {
        d.ageGroup = ageScale(d.age);
        });

        // Define gender groups
        var genderGroups = ["male", "female"];

        // Create nested data structure with age and gender categories
        var groupedData = d3.nest()
        .key(function (d) { return d.ageGroup; })
        .key(function (d) { return d.gender; })
        .rollup(function (values) {
            return {
            count: values.length
            };
        })
        .entries(data);

        // Log the result
        console.log(groupedData);

    </script>
</body>
</html>
